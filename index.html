  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manual P2P Video Call</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#111;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding:20px;
}
#login {
    display:flex;
    flex-direction:column;
    gap:10px;
    margin-bottom:20px;
    width:300px;
}
input {
    padding:10px;
    font-size:16px;
    border-radius:5px;
    border:none;
}
button {
    padding:10px;
    font-size:16px;
    border-radius:5px;
    border:none;
    cursor:pointer;
    background:#00ff88;
    color:#000;
    font-weight:bold;
}
#myIdContainer {
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:16px;
    margin-top:5px;
    padding:5px;
    background:#222;
    border-radius:5px;
}
#videos {
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top:20px;
}
video {
    width:300px;
    height:200px;
    background:#000;
    border:2px solid #00ff88;
    border-radius:5px;
}
</style>
</head>
<body>

<div id="login">
    <input type="text" id="name" placeholder="Enter Your Name">
    <input type="text" id="friendId" placeholder="Enter Friend's ID">
    <button id="startBtn">Start Video Call</button>
    <div id="myIdContainer">
        <span>Your ID: <strong id="myId">-</strong></span>
        <button id="copyIdBtn">Copy</button>
    </div>
</div>

<div id="videos">
    <video id="myVideo" autoplay muted></video>
</div>

<!-- PeerJS library -->
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
let myVideo = document.getElementById('myVideo');
let videosDiv = document.getElementById('videos');
let myIdSpan = document.getElementById('myId');
let localStream;

// Initialize PeerJS
const peer = new Peer(undefined, {
    host: '0.peerjs.com', // free PeerJS cloud server
    port: 443,
    secure: true
});

peer.on('open', id => {
    myIdSpan.textContent = id;
});

// Copy ID button
document.getElementById('copyIdBtn').addEventListener('click', () => {
    navigator.clipboard.writeText(myIdSpan.textContent)
        .then(()=>alert("ID Copied!"))
        .catch(()=>alert("Failed to copy"));
});

// Button click: request camera/mic and call friend
document.getElementById('startBtn').addEventListener('click', async () => {
    const friendId = document.getElementById('friendId').value;
    const name = document.getElementById('name').value || "Anonymous";

    if(!friendId) return alert("Enter Friend's ID");
    
    try {
        localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        myVideo.srcObject = localStream;

        // Call friend
        const call = peer.call(friendId, localStream);
        call.on('stream', remoteStream => addVideo(remoteStream));

        // Notify
        alert("Calling " + friendId + " ...");

    } catch(err) {
        alert('Error accessing camera/microphone: ' + err);
    }
});

// Answer incoming calls
peer.on('call', call => {
    const accept = confirm(`Incoming call from ${call.peer}. Accept?`);
    if(!accept) return;

    if(!localStream) {
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
            .then(stream => {
                localStream = stream;
                myVideo.srcObject = localStream;
                call.answer(localStream);
                call.on('stream', remoteStream => addVideo(remoteStream));
            }).catch(err => alert('Error accessing camera/microphone: ' + err));
    } else {
        call.answer(localStream);
        call.on('stream', remoteStream => addVideo(remoteStream));
    }
});

// Add remote video
function addVideo(stream) {
    const video = document.createElement('video');
    video.srcObject = stream;
    video.autoplay = true;
    videosDiv.appendChild(video);
}
</script>
</body>
</html>
