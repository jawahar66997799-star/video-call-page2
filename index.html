<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Live Video Call</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; text-align: center; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    video { width: 45%; margin: 10px; background: black; }
    #videos { display: flex; justify-content: center; flex-wrap: wrap; }
</style>
</head>
<body>

<h2>Live Video Call</h2>
<div id="login">
    <input type="text" id="name" placeholder="Enter Your Name" required>
    <input type="text" id="room" placeholder="Enter Room ID" required>
    <button id="joinBtn">Join Room</button>
</div>

<div id="call" style="display:none;">
    <h3>Room: <span id="roomLabel"></span></h3>
    <div id="videos">
        <video id="myVideo" autoplay muted></video>
        <video id="peerVideo" autoplay></video>
    </div>
</div>

<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
let myStream;
let peer;
let conn;
let call;

document.getElementById('joinBtn').addEventListener('click', async () => {
    const name = document.getElementById('name').value.trim();
    const room = document.getElementById('room').value.trim();
    if (!name || !room) return alert("Enter both name and room ID");

    document.getElementById('login').style.display = 'none';
    document.getElementById('call').style.display = 'block';
    document.getElementById('roomLabel').textContent = room;

    // Access camera & microphone
    try {
        myStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        document.getElementById('myVideo').srcObject = myStream;
    } catch(err) {
        alert("Camera/Microphone access denied!");
        return;
    }

    // Create Peer
    peer = new Peer(); // auto ID

    peer.on('open', id => {
        console.log("Your Peer ID:", id);

        // Connect to room (simple approach: call peer with same room ID)
        // For simplicity, assume one other user with the same room ID uses same logic
    });

    // When receiving a call
    peer.on('call', incomingCall => {
        incomingCall.answer(myStream); // answer with local stream
        incomingCall.on('stream', remoteStream => {
            document.getElementById('peerVideo').srcObject = remoteStream;
        });
        call = incomingCall;
    });

    // Join room logic (manual entry)
    const otherPeerId = prompt("Enter peer ID to connect (leave empty if waiting for someone)");
    if (otherPeerId) {
        call = peer.call(otherPeerId, myStream);
        call.on('stream', remoteStream => {
            document.getElementById('peerVideo').srcObject = remoteStream;
        });
    }
});
</script>

</body>
</html>
