<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Live Video Call</title>
<style>
  body { margin:0; font-family:sans-serif; background:#111; color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
  #form { display:flex; flex-direction:column; align-items:center; margin-bottom:20px; }
  input { padding:10px; margin:5px; width:200px; }
  button { padding:10px 20px; margin-top:10px; cursor:pointer; }
  #videos { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
  video { width:300px; height:200px; background:black; border:2px solid #0f0; }
</style>
</head>
<body>

<div id="form">
  <input type="text" id="name" placeholder="Enter your name" />
  <input type="text" id="room" placeholder="Enter room ID" />
  <button id="joinBtn">Join Room</button>
</div>

<div id="videos"></div>

<!-- PeerJS CDN -->
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
const joinBtn = document.getElementById("joinBtn");
const videosDiv = document.getElementById("videos");

joinBtn.onclick = async () => {
  const name = document.getElementById("name").value.trim();
  const roomID = document.getElementById("room").value.trim();
  if(!name || !roomID){ alert("Enter both name and room ID!"); return; }

  document.getElementById("form").style.display = "none";

  // Create your peer
  const peer = new Peer(); // random ID
  const peers = {}; // keep track of connected peers

  // Get local video + audio
  let stream;
  try {
    stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
  } catch(err){
    alert("Camera/microphone access denied!");
    return;
  }

  // Show your own video
  const myVideo = document.createElement("video");
  myVideo.srcObject = stream;
  myVideo.muted = true; // avoid echo
  myVideo.autoplay = true;
  myVideo.playsInline = true;
  videosDiv.appendChild(myVideo);

  // Connect to room using PeerJS
  peer.on("open", id => {
    console.log("Your Peer ID:", id);
    // Use roomID as the connecting key
    const conn = peer.connect(roomID);
    conn.on("open", () => {
      console.log("Connected to room");
      conn.send({ name, type:"join" });
    });
  });

  // Answer incoming calls
  peer.on("call", call => {
    call.answer(stream);
    call.on("stream", remoteStream => {
      addVideo(remoteStream);
    });
  });

  // Connect to others in the same room
  peer.on("connection", conn => {
    conn.on("data", data => {
      if(data.type==="join" && data.name){
        // Call the new peer
        const call = peer.call(conn.peer, stream);
        call.on("stream", remoteStream => addVideo(remoteStream));
      }
    });
  });

  function addVideo(remoteStream){
    const v = document.createElement("video");
    v.srcObject = remoteStream;
    v.autoplay = true;
    v.playsInline = true;
    videosDiv.appendChild(v);
  }

  alert("Joined room: " + roomID + "\nShare this room ID with your friend!");
};
</script>
</body>
</html>
